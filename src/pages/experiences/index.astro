---
import BaseLayout from '@layouts/BaseLayout.astro';
import { SITE_DESCRIPTION_EXPERIENCE, SITE_TITLE_EXPERIENCE } from '@constants/consts.ts';
import { getCollection, type CollectionEntry } from 'astro:content';
import XpLayout from '@layouts/XpLayout.astro';
import dayjs from 'dayjs';
import Badge from '@components/astro/atoms/Badge.astro';
import { Icon } from 'astro-icon/components';

const allExperience: CollectionEntry<'experience'>[] = await getCollection('experience');
---

<BaseLayout title={SITE_TITLE_EXPERIENCE} description={SITE_DESCRIPTION_EXPERIENCE}>
	<XpLayout
		title="Éxperiences"
		description="Voici un aperçu des lieux où j’ai travaillé, un simple résumé chronologique sans entrer dans les détails."
	>
		<div class="divide-y-2 py-5 flex flex-col items-center">
			{
				allExperience
					.sort(function (a: any, b: any) {
						return (
							+dayjs(b.data.startDate, 'YYYY-MM') -
							+dayjs(a.data.startDate, 'YYYY-MM')
						);
					})
					.map(async (detail) => {
						return (
							!detail.data.hidden && (
								<article class=" hover:bg-stone-200 w-7/12 p-5">
									<a href={`/experiences/${detail.slug}`} class="w-full">
										<div class="flex md:flex-row w-full">
											<div class="w-2/6">
												<h3 class="font-semibold">{detail.data.post}</h3>
												<p class="text-sm italic text-gray-700">
													{detail.data.startDate}{' '}
													{detail.data.endDate ? '-' : ''}
													{detail.data.endDate}
												</p>
											</div>
											<div class="w-3/6">
												<p>{detail.data.company}</p>
												<ul class="flex flex-row flex-wrap">
													{detail.data.packages.map((item: unknown) => (
														<li class="m-1">
															<Badge>{item}</Badge>
														</li>
													))}
												</ul>
											</div>
											<div class="w-1/6 flex justify-end md:items-center">
												<Icon
													name="arrow-right"
													class="text-3xl hover:scale-110"
												/>
											</div>
										</div>
									</a>
								</article>
							)
						);
					})
			}
		</div>
	</XpLayout>
</BaseLayout>
